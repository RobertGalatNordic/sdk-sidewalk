@startuml template state machine

[*] --> Running
state Running{
[*] --> Unregistered
Unregistered --> Started : on_status_changed(REGISTERED, NO_TIME)
Started --> Unregistered : on_status_changed(NOT_REGISTERED)
Started --> TimeSync : on_status_changed(REGISTERED, TIME_SYNCED)
TimeSync --> Started : on_status_changed(REGISTERED, NO_TIME)
TimeSync --> Ready : on_status_changed(REGISTERED, TIME_SYNCED)
TimeSync --> Ready : on_status_changed(REGISTERED, TIME_SYNCED)
TimeSync --> Ready : on_status_changed(REGISTERED, TIME_SYNCED)
Ready --> TimeSync : EVENT_BLE_LINK_DOWN
Ready --> TimeSync : EVENT_FSK_LINK_DOWN
Ready --> TimeSync : EVENT_LORA_LINK_DOWN
Ready --> Ready : EVENT_MSG_RCV
Ready --> SendHello : EVENT_SEND_MSG
SendHello --> Ready : EVENT_MSG_SEND
SendHello --> Ready : EVENT_MSG_SEND_ERROR
}
Running --> FirmwareUpdate
FirmwareUpdate --> [*]
Running --> FactoryReset
FactoryReset --> [*]
@enduml
